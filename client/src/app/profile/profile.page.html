<div class="flex min-h-screen text--gray-900">
	<app-sidebar></app-sidebar>
	<div class="flex-1 flex flex-col min-h-screen">
		<app-topbar [title]="L('Profile')"></app-topbar>
		<div class="ml-4 my-4">{{L("Your external IP address:")}} {{externalIP}}</div>
		<div class="flex gap-3 mt-4 mr-4">
			<div class="ml-4">{{L("This is your personal profile. The system settings can be tuned on the page:")}} <a routerLink="/settings" class="underline cursor-pointer">Settings</a></div>
		</div>
		<div>
			<main class="flex-1 p-6 bg-background space-y-6">
				<div class="border-b border--gray-200">
					<nav class="flex space-x-8">
						<button (click)="activeTab = 'general'" [class]="activeTab == 'general' ? 'border--blue-500 text--blue-600' : 'border-transparent text--gray-500 hover:text--gray-700 hover:border--gray-300'" class="py-2 px-1 border-b-2 font-medium text-sm transition-colors">
							{{L("General")}}
						</button>
						<button (click)="activeTab = 'identity'" [class]="activeTab == 'identity' ? 'border--blue-500 text--blue-600' : 'border-transparent text--gray-500 hover:text--gray-700 hover:border--gray-300'" class="py-2 px-1 border-b-2 font-medium text-sm transition-colors">
							{{L("Identity")}}
						</button>
						<button (click)="activeTab = 'security'" [class]="activeTab == 'security' ? 'border--blue-500 text--blue-600' : 'border-transparent text--gray-500 hover:text--gray-700 hover:border--gray-300'" class="py-2 px-1 border-b-2 font-medium text-sm transition-colors">
							{{L("Security")}}
						</button>
					</nav>
				</div>
				@if (activeTab == 'general') {
				<div class="rounded-xl border border--gray-200 p-6 shadow-sm">
					<h4 class="text-md font-medium text--gray-900 mb-2">{{L("Language")}}</h4>
					<p class="text-sm font-medium text--gray-700">{{L("Web App")}}</p>
					<div class="flex mt-2">
						<div class="flex rounded-lg border border--gray-200 p-1">
							<label class="relative flex flex-col cursor-pointer items-center justify-center rounded-md px-3 py-1.5 transition-all duration-300">
								<input type="radio" name="language" value="en" class="peer sr-only" checked (click)="global.changeLanguage('en');"/>
								<span class="absolute inset-0 z-0 rounded-md bg--gray-100 opacity-0 transition-all duration-300 peer-checked:opacity-100"></span>
								<span class="relative z-10 font-medium transition-all duration-300 peer-checked:text--gray-900">ðŸ‡ºðŸ‡¸<br>EN</span>
							</label>
							<label class="relative flex flex-col grow cursor-pointer items-center justify-center rounded-md px-3 py-1.5 transition-all duration-300">
								<input type="radio" name="language" value="fr" class="peer sr-only" (click)="global.changeLanguage('fr');"/>
								<span class="absolute inset-0 z-0 rounded-md bg--gray-100 opacity-0 transition-all duration-300 peer-checked:opacity-100"></span>
								<span class="relative z-10 font-medium transition-all duration-300 peer-checked:text--gray-900">ðŸ‡«ðŸ‡·<br>FR</span>
							</label>
						</div>
					</div>
					<div class="border-t border--gray-200 my-6"></div>
					<h4 class="text-md font-medium text--gray-900 mb-2">{{L("Power User")}}</h4>
					<div class="space-y-4 flex items-center justify-between">
						<div>
							<p class="text-sm font-medium text--gray-700">{{L("Enable")}}</p>
							<p class="text-sm text--gray-500">{{L("Give more advanced options.")}}</p>
						</div>
						<input type="checkbox" [(ngModel)]="global.settings.powerUser" class="w-4 h-4 text--blue-600 focus:ring--blue-500 border--gray-300 rounded">
					</div>
					<div class="border-t border--gray-200 my-6"></div>
					<h4 class="text-md font-medium text--gray-900 mb-2">{{L("Profile Settings")}}</h4>
					<div class="space-y-4 flex items-center justify-between">
						<div>
							<p class="text-sm font-medium text--gray-700">{{L("Reset")}}</p>
							<p class="text-sm text--gray-500">{{L("Restore default profile settings.")}}</p>
						</div>
						<button (click)="resetSettings()" class="inline-flex items-center gap-2 px-4 py-2 bg--yellow-600 text--white rounded-lg text-sm font-medium hover:bg--yellow-700 transition-colors cursor-pointer">
							<ion-icon name="refresh-outline" class="text--white w-4 h-4"></ion-icon>
							<span class="text-lg">{{L("Reset")}}</span>
						</button>
					</div>
				</div>
				}
				@if (activeTab == 'identity') {
				<div class="rounded-xl border border--gray-200 p-6 shadow-sm">
					<div class="flex items-center justify-between">
						<p class="text-sm font-medium text--gray-700">{{L("Name")}}</p>
						<input type="text" disabled="true" value="{{global.session.user.name}}" class="text--blue-600 focus:ring--blue-500 border--gray-300 rounded border grow ml-5 max-w-[50%]">
					</div>
					<div class="border-t border--gray-200 my-6"></div>
					<div class="flex items-center justify-between">
						<p class="text-sm font-medium text--gray-700">{{L("Username")}}</p>
						<input type="text" disabled="true" value="{{global.session.user.username}}" class="text--blue-600 focus:ring--blue-500 border--gray-300 rounded border grow ml-5 max-w-[50%]">
					</div>
					<div class="border-t border--gray-200 my-6"></div>
					<div class="flex items-center justify-between">
						<p class="text-sm font-medium text--gray-700">{{L("Email)")}}</p>
						<input type="text" disabled="true" value="{{global.session.user.email}}" class="text--blue-600 focus:ring--blue-500 border--gray-300 rounded border grow ml-5 max-w-[50%]">
					</div>
				</div>
				}
				@if (activeTab == 'security') {
				<div class="rounded-xl border border--gray-200 p-6 shadow-sm">
					<h4 class="text-md font-medium text--gray-900 mb-2">{{L("Two-Factor Authentication")}}</h4>
					<div class="space-y-4 flex items-center justify-between">
						<p class="text-sm font-medium text--gray-700">{{L("Enable")}}</p>
						<input type="checkbox" [(ngModel)]="TwoFA" (click)="showTwoFA()" class="w-4 h-4 text--blue-600 focus:ring--blue-500 border--gray-300 rounded">
					</div>
					<div class="border-t border--gray-200 my-6"></div>
					<h4 class="text-md font-medium text--gray-900 mb-2">{{L("Password")}}</h4>
					<div class="flex items-center justify-between">
						<p class="text-sm font-medium text--gray-700">{{L("Old")}}</p>
						<input type="password" class="text--blue-600 focus:ring--blue-500 border--gray-300 rounded border grow ml-5 max-w-[50%]">
					</div>
					<div class="my-6"></div>
					<div class="flex items-center justify-between">
						<p class="text-sm font-medium text--gray-700">{{L("New")}}</p>
						<input type="password" class="text--blue-600 focus:ring--blue-500 border--gray-300 rounded border grow ml-5 max-w-[50%]">
					</div>
					<div class="my-6"></div>
					<div class="flex items-center justify-between">
						<p class="text-sm font-medium text--gray-700">{{L("New (confirm)")}}</p>
						<input type="password" class="text--blue-600 focus:ring--blue-500 border--gray-300 rounded border grow ml-5 max-w-[50%]">
					</div>
					<div class="my-6"></div>
					<div class="flex items-center justify-between">
						<p class="text-sm font-medium text--gray-700"></p>
						<button class="inline-flex items-center gap-2 px-4 py-2 bg--yellow-600 text--white rounded-lg text-sm font-medium hover:bg--yellow-700 transition-colors cursor-pointer">
							<ion-icon name="cog-outline" class="text--white w-4 h-4"></ion-icon>
							<span class="text-lg">{{L("Submit")}}</span>
						</button>
					</div>
				</div>
				}
			</main>
		</div>
	</div>
</div>
<ion-modal #modalTwoFA>
	<ng-template>
			<h3 class="relative flex justify-between bg--blue-600 pt-2 pb-2 text--white" (click)="closeTwoFA()">
				<span class="mx-auto">{{L("Two-Factor Authentication")}}</span>
				<ion-icon name="close-circle-outline" class="w-6 h-6 absolute right-3 cursor-pointer"></ion-icon>
			</h3>
			<br>
			<div class="mx-5 mb-5">
				<div class="flex flex-col w-min-full items-center" [class]="showQRCode ? '' : 'hidden'">
					<span class="text-lg font-bold">Use this QR Code setup in your usual 2FA app</span><br>
					<span class="text-sm">(If you don't have one, we recommend the free, secure and Open Source <a href="https://getaegis.app" target="_blank" class="underline">Aegis</a> and <a href="https://2fas.com/auth/" target="_blank" class="underline">2FAS</a>)</span><br>
					<qrcode class="w-min-full" [qrdata]="dataQRCode" errorCorrectionLevel="M"></qrcode><br>
					<span class="text-xs max-w-sm break-all inline-block">{{dataQRCode}}</span>
				</div>
				<form [formGroup]="formTwoFA" (ngSubmit)="doTwoFA();" class="space-y-6" [class]="showQRCode ? 'hidden' : ''">
					<div>
						<label for="password1" class="block text-sm font-medium text--gray-700 mb-2">{{L("Password")}}</label>
						<div class="relative">
							<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
								<ion-icon name="lock-closed-outline" class="text--gray-500 w-4 h-4"></ion-icon>
							</div>
							<div class="flex items-center gap-0">
								<input #password1E formControlName="password1" autocomplete="current-password" required class="block w-full pl-10 pr-3 py-3 border border--gray-300 rounded-xl placeholder--gray-400 focus:outline-none focus:ring-2 focus:ring--blue-700 focus:border-transparent transition-colors duration-200 text--gray-900" placeholder="Enter your password" [class.border--red-300]="password1?.invalid && password1?.touched" [class.focus:ring--red-500]="password1?.invalid && password1?.touched" [type]="password1Show ? 'text' : 'password'">
								<button type="button" (click)="password1Show = !password1Show;" class="flex justify-center items-center bg--blue-600 p-2 rounded ml-2" style="cursor:pointer;"><ion-icon [name]="password1Show ? 'eye-off-outline' : 'eye-outline'" class="text--white"></ion-icon></button>
							</div>
						</div>
						@if (password1?.invalid && password1?.touched) {
						<div class="flex items-center gap-1 text--red-500 text-sm mt-2">
							<ion-icon name="alert-circle-outline" class="text--red-500 w-5 h-5"></ion-icon>
							{{L("Cannot be empty")}}
						</div>
						}
					</div>
					@if (errorSt) {
					<div class="bg--red-50 border border--red-200 rounded-xl p-4">
						<div class="flex items-center gap-2">
							<ion-icon name="alert-circle-outline" class="text--red-500 w-5 h-5"></ion-icon>
							<span class="text--red-800 text-sm font-medium">{{ errorSt }}</span>
						</div>
					</div>
					}
					<button type="submit" #submit1E [disabled]="progress || formTwoFA.invalid" class="w-full flex justify-center items-center gap-2 py-3 px-4 border border-transparent rounded-xl text-sm font-semibold text--white bg--blue-600 hover:bg--blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring--blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 text--gray-900 transform hover:scale-[1.02]">
						@if (progress) {
						<ion-icon name="cog-outline" class="animate-spin text--white w-6 h-6"></ion-icon>
						{{L("Enabling...")}}
						} @else {
						<ion-icon name="log-in-outline" class="text--white w-6 h-6"></ion-icon>
						{{L("Enable")}}
						}
					</button>
				</form>

			</div>
	</ng-template>
</ion-modal>
