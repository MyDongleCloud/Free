<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="tailwindcss-4.js"></script>
<script>
async function loadJson(st) {
	let data;
	try {
		const response = await fetch(st);
		if (!response.ok) return;
		data = await response.json();
	} catch(e) { return; }
	const h = Object.values(data)[0];
	const headers = [];
	Object.entries(h).forEach(([key, value]) => {
		headers.push(key);
	});
	const thead = document.getElementById("dataThead");
	thead.innerHTML = "";
	const headerRow = document.createElement("tr");
	let index = 0;
	headers.forEach(header => {
		const th = document.createElement("th");
		th.scope = "col";
		th.className = "text-left font-medium text--gray-500 tracking-wider px-2";
		let tmp = header.charAt(0).toUpperCase() + header.slice(1);
		if (header == "ai" || header == "web" || header == "status")
			tmp = tmp + "&nbsp;<input type='checkbox' id='" + header + "ID' class='border rounded'>";
		if (header == "module")
			tmp = "<a href='javascript:sort(0);' title='Toggle Sort'>" + tmp + "&nbsp;&nbsp;&nbsp;<a href='javascript:sort(-1);' title='Sort Descending'>↓</a>&nbsp;&nbsp;&nbsp;<a href='javascript:sort(1)' title='Sort Ascending'>↑</a>";
		if (header == "category" || header == "installMethod" || header == "githubLanguage") {
			tmp = "<select id='" + header + "ID' class='border rounded'><option value='" + header + "'>" + tmp + "</option>";
			const ll = [];
			Object.entries(data).forEach(([key, value]) => {
				if (!ll.includes(value[header]))
					ll.push(value[header]);
			});
			ll.sort();
			ll.forEach((value) => {
				if (value != "")
					tmp += "<option value='" + value + "'>" + value + "</option>";
			});
			tmp += "</select>";
		}
		th.innerHTML = tmp;
		if (index++ == 0)
			th.className = "bg-gray-700 sticky left-0 z-9 whitespace-nowrap px-2";
		else
			th.className = "whitespace-nowrap px-2";
		headerRow.appendChild(th);
	});
	thead.appendChild(headerRow);
	const tbody = document.getElementById("dataTbody");
	tbody.innerHTML = "";
	Object.entries(data).forEach(([key, value]) => {
		const data_ = [key];
		const tr = document.createElement("tr");
		tr.className = "hover:bg-gray-200";
		let first
		Object.entries(value).forEach(([kkey, vvalue], iindex) => {
			if (kkey == "githubUrl")
				vvalue = "<a href='https://github.com/" + vvalue + "' target='_blank' class='underline'>" + vvalue + "</a>";
			const td = document.createElement("td");
			if (iindex == 0)
				td.className = "font-bold bg-white border-r border-b border-gray-300 sticky left-0 z-9 whitespace-nowrap px-2";
			else
				td.className = " border-b border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis max-w-xs px-2";
			td.innerHTML = vvalue === false ? "" : vvalue;
			tr.appendChild(td);
		});
		tbody.appendChild(tr);
	});
}

var sortDir = 1;
function sort(dir) {
	if (dir == 0)
		sortDir = !sortDir;
	else
		sortDir = dir == -1;
	const tableBody = document.getElementById("dataTbody");
	const rows = Array.from(tableBody.querySelectorAll("tr"));
	rows.sort((rowA, rowB) => {
		const cellA = rowA.cells[0].textContent.trim();
		const cellB = rowB.cells[0].textContent.trim();
		return sortDir ? cellA.localeCompare(cellB) : cellB.localeCompare(cellA);
	});
	rows.forEach(row => { tableBody.appendChild(row); });
}

function checkInput() {
	document.getElementById("resetID").disabled = (document.getElementById("searchID").value === "");
}

function reset() {
	document.getElementById("searchID").value = "";
	checkInput();
}
</script>
<script>
function updateClass() {
	document.querySelectorAll("[data-class]").forEach(el => {
		const prevDynamicClasses = (el.dataset.dynamicClasses || "").split(" ");
		prevDynamicClasses.forEach(cls => cls && el.classList.remove(cls));
		const classExpression = el.dataset.class;
		const classesToApply = eval(classExpression) || "";
		const staticClasses = el.className.split(" ").filter(cls => !prevDynamicClasses.includes(cls));
		el.className = staticClasses.join(" ").trim();
		if (classesToApply) {
			const newClasses = classesToApply.split(" ");
			newClasses.forEach(cls => cls && el.classList.add(cls));
			el.dataset.dynamicClasses = newClasses.join(" ");
		} else
			el.dataset.dynamicClasses = "";
	});
}

function onStart() {
	loadJson("modulesmeta.json");
	checkInput();
}
</script>
</head>
<body onload="onStart();">
<div class="flex flex-col h-screen px-2 bg-white text-black">
	<div class="py-2">
		<label for="version">Version:</label>
		<select id="version" name="selectedOption" class="border rounded">
			<option value="HEAD">HEAD</option>
		</select>
	</div>
	<div class="py-2 relative flex items-center gap-2">
		<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
			<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-500" viewBox="0 0 512 512"><path d="M221.09 64a157.09 157.09 0 10157.09 157.09A157.1 157.1 0 00221.09 64z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M338.29 338.29L448 448"/></svg>
		</div>
		<input type="text" id="searchID" oninput="checkInput()" placeholder="Filter modules..." class="pl-10 pr-4 border border-gray-300 text-gray-500 rounded-lg">
		<button id="resetID" onclick="reset()" class="inline-flex items-center bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors cursor-pointer disabled:bg-gray-100 disabled:cursor-default disabled:text-gray-400" data-class="document.getElementById('searchID').value == '' ? 'hidden' : ''">
			<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 512 512"><path d="M320 146s24.36-12-64-12a160 160 0 10160 160" fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32"/><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 58l80 80-80 80"/></svg>
		</button>
	</div>
	<div class="overflow-y-auto">
		<table class="border-separate border-spacing-0">
			<thead class="sticky top-0 z-10 bg-gray-700 text-gray-200" id="dataThead">
			</thead>
			<tbody id="dataTbody">
			</tbody>
		</table>
	</div>
</div>
</body>
</html>
